import{_ as T}from"./CsXGeD-1.js";import{O as k}from"./BJXxDcfv.js";import{g as y,av as A,r as c,a4 as b,a5 as S,a6 as $,a7 as r,n as w,aj as R,ad as C,ae as O,ar as P}from"./assets/index-DPNg1h3L.js";import{_ as B}from"./DHAma4aW.js";import"./BjZ6MRbD.js";import"./CofZGm4l.js";import"./Ci706Hx-.js";import"./9IVxa3Pp.js";import"./BzrPP_OP.js";import"./ClufGFaH.js";const G=y({__name:"IndexPage",setup(D){const n=A(),o=n.currentRoute.value.params.func,i=n.currentRoute.value.params.platform,f=n.currentRoute.value.query,l=t=>{const e=`${o==="bind"?"绑定":"授权"} ${i.toString()} `;switch(t){case"loading":return`${e}中...`;case"success":return`${e}成功`;case"error":return`${e}失败`;default:return"错误，请联系管理员"}},v=t=>{switch(t){case"loading":return"正在探索服务器的世界...";case"success":return"成功与终端建立连接";case"error":return"终端拒绝了你的想法";default:return"错误，请联系管理员"}},g=c(!1),m=c(l("loading")),p=c(v("loading")),u=c(""),a=c(5),d=()=>{a.value=a.value-1},x=t=>{k.bindAccountOAuth(i.toString(),f).then(e=>{t.value="success",u.value=e.message||"绑定成功",setInterval(()=>{d(),a.value===0&&_()},1e3)}).catch(e=>{t.value="error",u.value=e.error}).finally(()=>{m.value=l(t.value),p.value=v(t.value)})},I=t=>{k.callbackAccountOAuth(i.toString(),f).then(e=>{t.value="success";const s=setInterval(()=>{d(),a.value===0&&(clearInterval(s),w(()=>{const h=R();h.setToken(e.token,e.token_timeout),h.setRefreshToken(e.refresh_token,e.refresh_token_timeout),n.push({name:"HomePage"})}))},1e3)}).catch(e=>{if(t.value="error",e.code===20114&&(e.error+="，你是不是没有注册账户呢？"),u.value=e.error,e.code===30101){g.value=!0;const s=setInterval(()=>{d(),a.value===0&&(clearInterval(s),w(()=>{n.push({name:"LoginPage"})}))},1e3)}}).finally(()=>{m.value=l(t.value),p.value=v(t.value)})},_=()=>{window.close()};return(t,e)=>(b(),S(r(T),{title:m.value,description:p.value,"response-message":u.value,init:r(o)==="bind"?x:I},{"operating-area":$(({status:s})=>[r(o)!=="bind"&&s!=="error"||g.value?(b(),S(r(B),{key:0,onClick:_,variant:"outline",disabled:r(o)!=="bind"},{default:$(()=>[C(O(a.value+"秒后"+(r(o)==="bind"?"自动关闭":"回到主页")),1)]),_:1},8,["disabled"])):P("",!0)]),_:1},8,["title","description","response-message","init"]))}});export{G as default};
