import{b as Ce,_ as Ne,a as ke}from"./BvV4tLCH.js";import{_ as Se}from"./HmYcjI_V.js";import{_ as Y,c as j}from"./CyG_wUY-.js";import{_ as H}from"./BEuhXvc7.js";import{_ as A,a as K,b as q,c as E}from"./BHGwB7GL.js";import{q as se,m as L,bH as ze,p as le,g as R,t as Te,s as oe,x as W,bI as Pe,Q as Ie,y as Re,r as w,Z as M,k as y,bJ as Fe,T as Be,bK as Ue,a4 as g,ag as x,ab as t,a6 as s,a7 as e,aa as m,ad as k,A as ie,w as re,ae as h,H as U,ah as Q,a5 as G,ar as B,bL as je,n as Le,aq as F,ac as ee,l as ue,aB as Oe,j as We}from"./assets/index-FK6NKOEU.js";import{W as De,T as P}from"./Be5pzGHL.js";import{u as D}from"./Cq1ZMuN5.js";import{c as de,_ as Ve,a as Ye,b as He,d as Ae,e as Ke,f as qe,g as Ee}from"./CNw2utPJ.js";import{O as N,I as Me}from"./_n7zrSvp.js";import{t as ce,o as me,s as Ge,k as pe,b as fe,_ as _e,f as ye,c as ge,g as ve,n as Je}from"./pROuP_Rl.js";import{_ as Qe}from"./C672HGWJ.js";import{_ as he,a as xe}from"./CTsTF-LE.js";import{_ as Xe,a as Ze,b as et,c as tt,d as at}from"./CpMCGv7F.js";import{d as nt,e as st,_ as lt,b as ot,a as it,c as rt}from"./JsQ4BiHf.js";import{_ as ut,a as dt,c as ct,d as mt}from"./BntFePjb.js";import{_ as O}from"./C-AZkT3w.js";import{u as pt}from"./D86VDNy1.js";import"./i_uLiTgv.js";import"./CnPnw603.js";import"./DEPmpnye.js";const ft=se([se("@keyframes spin-rotate",`
 from {
 transform: rotate(0);
 }
 to {
 transform: rotate(360deg);
 }
 `),L("spin-container",`
 position: relative;
 `,[L("spin-body",`
 position: absolute;
 top: 50%;
 left: 50%;
 transform: translateX(-50%) translateY(-50%);
 `,[ze()])]),L("spin-body",`
 display: inline-flex;
 align-items: center;
 justify-content: center;
 flex-direction: column;
 `),L("spin",`
 display: inline-flex;
 height: var(--n-size);
 width: var(--n-size);
 font-size: var(--n-size);
 color: var(--n-color);
 `,[le("rotate",`
 animation: spin-rotate 2s linear infinite;
 `)]),L("spin-description",`
 display: inline-block;
 font-size: var(--n-font-size);
 color: var(--n-text-color);
 transition: color .3s var(--n-bezier);
 margin-top: 8px;
 `),L("spin-content",`
 opacity: 1;
 transition: opacity .3s var(--n-bezier);
 pointer-events: all;
 `,[le("spinning",`
 user-select: none;
 -webkit-user-select: none;
 pointer-events: none;
 opacity: var(--n-opacity-spinning);
 `)])]),_t={small:20,medium:18,large:16},yt=Object.assign(Object.assign({},oe.props),{contentClass:String,contentStyle:[Object,String],description:String,stroke:String,size:{type:[String,Number],default:"medium"},show:{type:Boolean,default:!0},strokeWidth:Number,rotate:{type:Boolean,default:!0},spinning:{type:Boolean,validator:()=>!0,default:void 0},delay:Number}),gt=R({name:"Spin",props:yt,setup(n){const{mergedClsPrefixRef:o,inlineThemeDisabled:a}=Te(n),p=oe("Spin","-spin",ft,Ue,n,o),u=W(()=>{const{size:i}=n,{common:{cubicBezierEaseInOut:f},self:C}=p.value,{opacitySpinning:v,color:l,textColor:b}=C,_=typeof i=="number"?Pe(i):C[Ie("size",i)];return{"--n-bezier":f,"--n-opacity-spinning":v,"--n-size":_,"--n-color":l,"--n-text-color":b}}),d=a?Re("spin",W(()=>{const{size:i}=n;return typeof i=="number"?String(i):i[0]}),u,n):void 0,r=pt(n,["spinning","show"]),c=w(!1);return M(i=>{let f;if(r.value){const{delay:C}=n;if(C){f=window.setTimeout(()=>{c.value=!0},C),i(()=>{clearTimeout(f)});return}}c.value=r.value}),{mergedClsPrefix:o,active:c,mergedStrokeWidth:W(()=>{const{strokeWidth:i}=n;if(i!==void 0)return i;const{size:f}=n;return _t[typeof f=="number"?"medium":f]}),cssVars:a?void 0:u,themeClass:d==null?void 0:d.themeClass,onRender:d==null?void 0:d.onRender}},render(){var n,o;const{$slots:a,mergedClsPrefix:p,description:u}=this,d=a.icon&&this.rotate,r=(u||a.description)&&y("div",{class:`${p}-spin-description`},u||((n=a.description)===null||n===void 0?void 0:n.call(a))),c=a.icon?y("div",{class:[`${p}-spin-body`,this.themeClass]},y("div",{class:[`${p}-spin`,d&&`${p}-spin--rotate`],style:a.default?"":this.cssVars},a.icon()),r):y("div",{class:[`${p}-spin-body`,this.themeClass]},y(Fe,{clsPrefix:p,style:a.default?"":this.cssVars,stroke:this.stroke,"stroke-width":this.mergedStrokeWidth,class:`${p}-spin`}),r);return(o=this.onRender)===null||o===void 0||o.call(this),a.default?y("div",{class:[`${p}-spin-container`,this.themeClass],style:this.cssVars},y("div",{class:[`${p}-spin-content`,this.active&&`${p}-spin-content--spinning`,this.contentClass],style:this.contentStyle},a),y(Be,{name:"fade-in-transition"},{default:()=>this.active?c:null})):c}}),vt=R({__name:"RedemptionCodeForm",props:{loading:{type:Boolean,default:!1}},emits:["update:setLoading"],setup(n,{emit:o}){const a=n,p=o,u=ce(me({code:Ge({required_error:"兑换码不能为空",invalid_type_error:"兑换码格式错误"}).min(26,{message:"兑换码格式错误"}).max(26,{message:"兑换码格式错误"})})),d=pe({validationSchema:u}),{handleSubmit:r}=d,c=r(i=>{p("update:setLoading",!0),De.useWalletCode(i.code).then(f=>{p("update:setLoading",!1),D().setWallet(f),d.resetForm(),N.success("兑换成功")}).catch(f=>{p("update:setLoading",!1),N.error(f.error||"兑换失败")})});return(i,f)=>(g(),x("form",{class:"space-y-6",onSubmit:f[0]||(f[0]=(...C)=>e(c)&&e(c)(...C))},[t(e(ve),{name:"code"},{default:s(({componentField:C})=>[t(e(fe),null,{default:s(()=>[t(e(_e),{class:"text-lg font-bold flex justify-between"},{default:s(()=>[f[2]||(f[2]=m("span",null,"兑换码",-1)),t(e(Y),{type:"submit",disabled:a.loading},{default:s(()=>f[1]||(f[1]=[k(" 兑换 ")])),_:1},8,["disabled"])]),_:1}),t(e(ye),null,{default:s(()=>[t(e(Qe),ie({type:"text",placeholder:"请输入兑换码"},C),null,16)]),_:2},1024),t(e(ge))]),_:2},1024)]),_:1})],32))}}),ht={class:"sm:gap-2 sm:items-center sm:flex sm:flex-wrap"},xt=["src","alt"],bt={key:0,class:"flex items-center"},$t={key:1},wt={key:2,class:"flex items-center"},Ct=R({__name:"RechargeForm",props:{loading:{type:Boolean,default:!1},paymentList:{}},emits:["update:loading"],setup(n,{emit:o}){const a=n,p=o,u=W(()=>a.paymentList),d=w(10),r=w(""),c=v=>{if(f.values.money===void 0)return;if(Array.isArray(v)?r.value=v[0]:r.value=v===void 0?"":v,!r.value){d.value=f.values.money;return}const l=u.value.find(b=>b.uuid===r.value);if(l){let b=d.value;if(l.handling_fee_fixed>0&&(b+=l.handling_fee_fixed),l.handling_fee_percent>0){let _=parseFloat((b*(l.handling_fee_percent/100)).toFixed(2));_>l.handling_fee_percent_max&&(_=l.handling_fee_percent_max),b+=_}d.value=b}},i=ce(me({money:Je({required_error:"",invalid_type_error:"金额格式错误"}).min(10,{message:"最低10，充值金额太少了"}).max(500,{message:"最高500, 超出限制直接联系管理员，手续费太坑了"}).default(10)})),f=pe({validationSchema:i});re(f.values,v=>{v.money!=d.value&&(d.value=v.money,c(r.value===void 0?"":r.value))});const C=f.handleSubmit(v=>{if(r.value===""){N.error("请选择支付方式");return}p("update:loading",!0),P.createTopUpRedirect({money:v.money,payment:r.value}).then(l=>{setTimeout(()=>{window.open(l.redirect,"_blank")},2e3);let b=l.expire_time;N.promise(()=>new Promise((_,S)=>{const V=setInterval(()=>{P.checkPayStatus({session:l.trade_no,payment:r.value}).then(J=>{J.status===1002&&(clearInterval(V),clearTimeout(Z),_(J))}).catch(J=>{clearInterval(V),clearTimeout(Z),S(J)})},4e3),Z=setInterval(()=>{b-=1,b<=0&&(clearInterval(V),clearInterval(Z),S({error:"支付超时，请重新尝试",code:-408}))},1e3)}),{loading:"等待支付中，请勿关闭页面......",success:_=>(D().initWallet(),p("update:loading",!1),f.resetForm(),c(""),_.status_label),error:_=>(D().initWallet(),p("update:loading",!1),_.error),position:"top-center"})}).catch(l=>{p("update:loading",!1),N.error(l.error)})});return(v,l)=>(g(),x("form",{class:"space-y-6",onSubmit:l[0]||(l[0]=(...b)=>e(C)&&e(C)(...b))},[t(e(ve),{name:"money"},{default:s(({componentField:b})=>[t(e(fe),null,{default:s(()=>[t(e(_e),{class:"text-lg font-bold flex justify-between"},{default:s(()=>[m("span",null,"实付金额：￥"+h(isNaN(d.value)?0:d.value),1),t(e(Y),{type:"submit",disabled:a.loading},{default:s(()=>l[1]||(l[1]=[k(" 充值 ")])),_:1},8,["disabled"])]),_:1}),t(e(ye),null,{default:s(()=>[t(e(Xe),ie({id:"money","default-value":d.value,"format-options":{style:"currency",currency:"CNY",currencyDisplay:"code",currencySign:"accounting"},min:0,max:500},b,{disabled:a.loading}),{default:s(()=>[t(e(Ze),null,{default:s(()=>[t(e(et)),t(e(tt)),t(e(at))]),_:1})]),_:2},1040,["default-value","disabled"])]),_:2},1024),t(e(ge)),m("div",ht,[l[2]||(l[2]=m("div",{class:"flex items-center justify-between w-full mt-4"},[m("div",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"支付方式"),m("a",{href:"#",class:"text-sm font-medium text-indigo-600 hover:text-indigo-500"}," 支付说明 ")],-1)),t(e(he),{variant:"outline",type:"single",class:"mt-2 grid grid-cols-4 md:grid-cols-5 gap-5 md:gap-6","model-value":r.value,"onUpdate:modelValue":c},{default:s(()=>[(g(!0),x(U,null,Q(u.value,_=>(g(),G(e(xe),{key:_.uuid,value:_.uuid,class:"px-1! py-2!","aria-label":_.name,variant:"outline",disabled:a.loading},{default:s(()=>[t(e(A),null,{default:s(()=>[t(e(K),null,{default:s(()=>[t(e(q),{"as-child":""},{default:s(()=>[m("img",{src:_.icon,alt:_.name,class:"rounded-md object-cover size-6 md:size-8 object-scale-down"},null,8,xt)]),_:2},1024),t(e(E),{class:"text-sm text-gray-900"},{default:s(()=>[m("p",null,h(_.name),1),_.handling_fee_fixed>0?(g(),x("p",bt,"固定手续费：￥"+h(_.handling_fee_fixed),1)):B("",!0),_.handling_fee_percent>0?(g(),x("p",$t,"手续费："+h(_.handling_fee_percent)+"%",1)):B("",!0),_.handling_fee_percent_max>0?(g(),x("p",wt," 手续费比例最高扣除：￥"+h(_.handling_fee_percent_max),1)):B("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["value","aria-label","disabled"]))),128))]),_:1},8,["model-value"])])]),_:2},1024)]),_:1})],32))}}),be=w(-1),$e=w(-1),I=w({pageIndex:0,pageSize:10}),$=w(!1),te=(n,o)=>{$.value=!0,P.getTopUpHistory({limit:o,page:n}).then(a=>{Le(()=>{Array.isArray(a.items)&&(z.value=a.items),be.value=Math.ceil(a.total/o),$e.value=a.total,$.value=!1})}).catch(a=>{N.error(a.error),$.value=!1})},Nt=({pageIndex:n,pageSize:o})=>{I.value.pageIndex=n,I.value.pageSize=o};M(()=>{te(I.value.pageIndex+1,I.value.pageSize)});const X=w(!1),kt=n=>{X.value=n},St=n=>{$.value=!0,P.cancelTopUp(z.value[n].number).then(o=>{const a=[...z.value];a[n].pay_status=3,a[n].pay_status_label="取消支付",z.value=a,$.value=!1,X.value=!1,N.success(o.message||"取消成功")}).catch(o=>{$.value=!1,N.error(o.error)})},we=(n,o,a=3600,p=!1)=>{N.promise(()=>new Promise((u,d)=>{const r=setInterval(()=>{a-=1,a<=0&&(clearInterval(c),clearInterval(r),d({error:"支付超时，请重新尝试",code:-408}))},1e3),c=setInterval(()=>{P.checkPayStatus({session:o,payment:T.value}).then(i=>{i.status===1002&&(clearInterval(c),clearTimeout(r),u(i))}).catch(i=>{clearInterval(c),clearTimeout(r),d(i)})},4e3)}),{loading:"等待支付中，请勿关闭页面......",success:u=>{if(D().initWallet(),$.value=!1,T.value="",X.value=!1,p)te(I.value.pageIndex+1,I.value.pageSize);else{const d=[...z.value];d[n].pay_status=1,d[n].pay_status_label="支付成功",z.value=d}return u.status_label},error:u=>(D().initWallet(),$.value=!1,u.error),position:"top-center"})},zt=n=>{$.value=!0,P.continuePayRecord(z.value[n].number).then(o=>{setTimeout(()=>{window.open(o.redirect,"_blank")},2e3);const a=new Date().getTime()-new Date(z.value[n].expire_time).getTime();we(n,z.value[n].trade_no,a/1e3)}).catch(o=>{$.value=!1,N.error(o.error)})},Tt=n=>{$.value=!0,P.createTopUpRedirect({payment:T.value,money:ae.value}).then(o=>{setTimeout(()=>{window.open(o.redirect,"_blank")},2e3),we(n,o.trade_no,o.expire_time,!0)}).catch(o=>{$.value=!1,N.error(o.error)})},Pt=n=>{if(!T.value||T.value===""||!ne.value.some(o=>o.uuid===T.value)){N.error("请选择支付方式");return}if(T.value===z.value[n].payment_no){zt(n);return}if(ae.value===0){N.error("支付金额错误，请联系管理员查看");return}Tt(n)},ae=w(0),T=w(""),ne=w([]);function It(n){ne.value=n}const z=je([]),Rt=[{id:"pay_name",accessorKey:"payment_name",header:"支付渠道",cell:({row:n})=>y("div",{class:"capitalize"},n.original.payment_name),enableSorting:!1,enableHiding:!1},{id:"pay_money",accessorKey:"pay_money",header:"支付金额",cell:({row:n})=>{const o=new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(Number(n.getValue("pay_money"))/100);return y(Xt,{row:n},{default:()=>y("div",{class:"flex space-x-1 justify-center items-center"},[y("span",o),y(Me,{icon:"radix-icons:question-mark-circled",class:"size-4"})])})},enableSorting:!1,enableHiding:!1},{id:"支付状态",accessorKey:"pay_status",header:"支付状态",cell:({row:n})=>y(nt,{variant:"outline",class:["dark:text-white text-black",["bg-gray-500","bg-green-500","bg-red-500","bg-yellow-500"][n.original.pay_status]]},{default:()=>n.original.pay_status_label})},{id:"发起时间",accessorKey:"created_at",header:()=>"发起时间",cell:({row:n})=>n.original.created_at},{id:"超时时间",accessorKey:"expire_time",header:"超时时间",cell:({row:n})=>n.original.pay_status===0||n.original.pay_status===2?n.original.expire_time:"-"},{id:"更新时间",accessorKey:"updated_at",header:"更新时间",cell:({row:n})=>n.original.updated_at},{id:"actions",cell:({row:n})=>y("div",{class:"relative"},[y(Qt,{open:X.value,row:n,loading:$.value,"onUpdate:setOpen":kt,"onUpdate:cancelRecord":St,"onUpdate:payRecord":Pt},{"pay-slot":()=>y(la,{payments:ne.value,oldPayment:n.original.payment_no,payment:T.value,price:n.original.actual_amount,loading:$.value,"onUpdate:payment":o=>{T.value=o},"onUpdate:price":o=>ae.value=o})})]),enableHiding:!1}],Ft={sm:["支付状态","发起时间","超时时间","更新时间"],lg:["发起时间","超时时间"]},Bt={class:"w-full"},Ut=R({__name:"TopUpRecord",props:{payments:{},parentLoading:{type:Boolean}},setup(n){return re(()=>n.parentLoading,o=>{o||setTimeout(()=>{te(1,I.value.pageSize)},1e3)}),M(()=>{It(n.payments)}),(o,a)=>(g(),x("div",Bt,[t(e(de),{loading:e($)},{default:s(()=>[t(e(st),{data:e(z),columns:e(Rt),"is-selectable":!1,filters:[],hiddenFilters:e(Ft),pagination:e(I),totalPage:e(be),totalCount:e($e),onSetPagination:e(Nt)},null,8,["data","columns","hiddenFilters","pagination","totalPage","totalCount","onSetPagination"])]),_:1},8,["loading"])]))}}),jt={class:"text-xs"},Lt={class:"container"},Ot={class:"grid grid-cols-2 justify-items-center text-center"},Wt={class:"space-y-2"},Dt={class:"text-sm text-muted-foreground"},Vt={class:"space-y-1"},Yt={class:"text-sm text-muted-foreground"},Ht={class:"space-y-2"},At={class:"text-sm text-muted-foreground"},Kt={class:"space-y-1"},qt={class:"text-sm text-muted-foreground"},Et={class:"space-y-1"},Mt={class:"text-sm text-muted-foreground"},Gt={class:"space-y-1"},Jt={class:"text-sm text-muted-foreground"},Qt=R({__name:"TopUpRecordDetail",props:{loading:{type:Boolean},open:{type:Boolean},row:{}},emits:["update:setOpen","update:cancelRecord","update:payRecord"],setup(n,{emit:o}){const a=n,p=o,u=W(()=>a.row.original),d=new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(Number(u.value.pay_money/100)),r=new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(Number(u.value.handling_fee/100)),c=new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(Number(u.value.actual_amount/100)),i=[];if(a.row.original.handling_fee>0){const v=new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(a.row.original.handling_fee/100);i.push(y("div","手续费: "+v))}if(a.row.original.handling_fee_fixed>0){const v=new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(a.row.original.handling_fee_fixed);i.push(y("div",`固定手续费：${v}`))}a.row.original.handling_fee_percent>0&&i.push(y("div",`手续费比例：${a.row.original.handling_fee_percent}%`));const f=w(!1),C=v=>{a.loading||(f.value=v)};return M(()=>{a.open===!1&&(f.value=!1)}),(v,l)=>{const b=it,_=rt;return g(),G(e(mt),{open:f.value,"onUpdate:open":[l[4]||(l[4]=S=>f.value=S),C]},{default:s(()=>[t(e(ut),{"as-child":""},{default:s(()=>[t(e(Y),{variant:"ghost",class:"flex h-8 w-8 p-0 data-[state=open]:bg-muted"},{default:s(()=>[t(b,{class:"h-4 w-4"}),l[5]||(l[5]=m("span",{class:"sr-only"},"Open menu",-1))]),_:1})]),_:1}),t(e(dt),{align:"end",class:"w-[160px]"},{default:s(()=>[t(e(lt),null,{default:s(()=>l[6]||(l[6]=[k("操作")])),_:1}),t(e(Ve),{open:a.open,"onUpdate:open":l[3]||(l[3]=S=>{a.loading||p("update:setOpen",S)})},{default:s(()=>[t(e(Ye),null,{default:s(()=>[t(e(ct),{onSelect:l[0]||(l[0]=S=>S.preventDefault())},{default:s(()=>l[7]||(l[7]=[k(" 详情 ")])),_:1})]),_:1}),t(e(He),null,{default:s(()=>[t(e(de),{loading:v.loading},{default:s(()=>[t(e(Ae),null,{default:s(()=>[t(e(Ke),{class:"flex space-x-2"},{default:s(()=>[l[8]||(l[8]=m("span",null," 支付记录 ",-1)),m("div",jt,"更新时间 "+h(u.value.updated_at),1)]),_:1}),t(e(qe),{class:"items-center text-center"},{default:s(()=>[m("div",{class:F(["inline-block rounded-lg my-2 p-3 bg-gray-100 dark:bg-muted/50 font-bold",[u.value.pay_status==1?"text-green!":"",u.value.pay_status==2?"text-red!":"",u.value.pay_status==3?"text-yellow":""]])},h(u.value.pay_status_label),3),l[9]||(l[9]=m("div",{class:"space-y-1 text-center"},[m("h4",{class:"text-sm font-medium leading-none color-indigo-400"},"Thank you!"),m("p",{class:"text-sm text-muted-foreground"},"如果您有任何疑问，请联系我们。")],-1))]),_:1})]),_:1}),m("div",Lt,[t(e(H),{class:"my-1"}),m("div",Ot,[m("div",Wt,[t(e(O),{class:"text-lg font-medium"},{default:s(()=>l[10]||(l[10]=[k("支付渠道")])),_:1}),m("div",Dt,h(u.value.payment_name),1)]),m("div",Vt,[t(e(O),{class:"text-lg font-medium"},{default:s(()=>l[11]||(l[11]=[k("支付金额")])),_:1}),m("div",Yt,h(e(d)),1)]),m("div",Ht,[t(e(O),{class:"text-lg font-medium"},{default:s(()=>l[12]||(l[12]=[k("创建时间")])),_:1}),m("div",At,h(u.value.created_at),1)]),m("div",Kt,[t(e(A),null,{default:s(()=>[t(e(K),null,{default:s(()=>[t(e(q),{"as-child":""},{default:s(()=>[t(e(O),{class:"text-lg font-medium flex items-center cursor-pointer"},{default:s(()=>[l[13]||(l[13]=k(" 手续费 ")),t(_,{class:"ml-1 size-4 color-red-600"})]),_:1}),m("div",qt,h(e(r)),1)]),_:1}),t(e(E),{class:"z-999999999999"},{default:s(()=>[(g(),x(U,null,Q(i,(S,V)=>t(ee(S),{key:V})),64))]),_:1})]),_:1})]),_:1})]),m("div",Et,[t(e(O),{class:"text-lg font-medium"},{default:s(()=>l[14]||(l[14]=[k("支付截止")])),_:1}),m("div",Mt,h(u.value.pay_status==1?"-":u.value.expire_time),1)]),m("div",Gt,[t(e(O),{class:"text-lg font-medium"},{default:s(()=>l[15]||(l[15]=[k("到账金额")])),_:1}),m("div",Jt,h(e(c)),1)])])]),u.value.pay_status==0?(g(),x(U,{key:0},[t(e(H),{class:"my-2"}),ue(v.$slots,"pay-slot"),t(e(H),{class:"my-2"}),t(e(ot),null,{default:s(()=>[t(e(Y),{variant:"outline",onClick:l[1]||(l[1]=S=>p("update:cancelRecord",a.row.index))},{default:s(()=>l[16]||(l[16]=[k(" 取消 ")])),_:1}),t(e(Y),{onClick:l[2]||(l[2]=S=>p("update:payRecord",a.row.index))},{default:s(()=>l[17]||(l[17]=[k("支付")])),_:1})]),_:1})],64)):B("",!0)]),_:3},8,["loading"])]),_:3})]),_:3},8,["open"])]),_:3})]),_:3},8,["open"])}}}),Xt=R({__name:"TopUpRecordPayMoneyTooltip",props:{row:{}},setup(n){const o=n,a=W(()=>o.row),p=new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(a.value.original.actual_amount/100),u=[y("div","到账金额: "+p)];if(a.value.original.handling_fee>0){const d=new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(a.value.original.handling_fee/100);u.push(y("div","手续费: "+d))}if(a.value.original.handling_fee_fixed>0){const d=new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(a.value.original.handling_fee_fixed);u.push(y("div",`固定手续费：${d}`))}return a.value.original.handling_fee_percent>0&&u.push(y("div",`手续费比例：${a.value.original.handling_fee_percent}%`)),(d,r)=>(g(),G(e(A),null,{default:s(()=>[t(e(K),null,{default:s(()=>[t(e(q),null,{default:s(()=>[ue(d.$slots,"default")]),_:3}),t(e(E),null,{default:s(()=>[(g(),x(U,null,Q(u,(c,i)=>t(ee(c),{key:i})),64))]),_:1})]),_:3})]),_:3}))}}),Zt={class:"sm:gap-2 sm:items-center sm:flex sm:flex-wrap"},ea=["src","alt"],ta={key:0,class:"flex items-center"},aa={key:1},na={key:2,class:"flex items-center"},sa={key:1},la=R({__name:"PayPayment",props:{price:{default:0},oldPayment:{},payments:{},loading:{type:Boolean,default:!1},payment:{default:""}},emits:["update:payment","update:price"],setup(n,{emit:o}){const a=n,p=o,u=r=>{Array.isArray(r)?p("update:payment",r[0]):p("update:payment",r)},d=w(0);return a.oldPayment!=""&&u(a.oldPayment),M(()=>{if(a.payment){const r=a.payments.find(c=>c.uuid===a.payment);if(r){let c=a.price/100;if(r.handling_fee_fixed>0&&(c+=r.handling_fee_fixed),r.handling_fee_percent>0){let i=parseFloat((c*(r.handling_fee_percent/100)).toFixed(2));i>r.handling_fee_percent_max&&(i=r.handling_fee_percent_max),c+=i}d.value=c,p("update:price",c)}}}),(r,c)=>(g(),x("div",Zt,[c[0]||(c[0]=m("div",{class:"flex items-center justify-between w-full mt-4"},[m("div",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"支付方式"),m("div",{class:"text-sm font-medium text-indigo-600 hover:text-indigo-500 text-size-xs"}," 默认创建支付渠道，可选其他，注意手续费，悬浮查看手续费详情 ")],-1)),t(e(he),{variant:"outline",type:"single",class:"mt-2 grid grid-cols-4 md:grid-cols-5 gap-5 md:gap-6","model-value":r.payment,"onUpdate:modelValue":u},{default:s(()=>[(g(!0),x(U,null,Q(a.payments,i=>(g(),G(e(xe),{key:i.uuid,value:i.uuid,class:"px-1! py-2!","aria-label":i.name,variant:"outline",disabled:a.loading},{default:s(()=>[t(e(A),null,{default:s(()=>[t(e(K),null,{default:s(()=>[t(e(q),{"as-child":""},{default:s(()=>[m("img",{src:i.icon,alt:i.name,class:"rounded-md object-cover size-6 md:size-8 object-scale-down"},null,8,ea)]),_:2},1024),t(e(E),{class:"text-sm text-gray-900"},{default:s(()=>[m("p",null,h(i.name),1),a.oldPayment!==i.uuid?(g(),x(U,{key:0},[i.handling_fee_fixed>0?(g(),x("p",ta,"固定手续费：￥"+h(i.handling_fee_fixed),1)):B("",!0),i.handling_fee_percent>0?(g(),x("p",aa,"手续费："+h(i.handling_fee_percent)+"%",1)):B("",!0),i.handling_fee_percent_max>0?(g(),x("p",na," 手续费比例最高扣除：￥"+h(i.handling_fee_percent_max),1)):B("",!0),m("p",null," 实际支付: "+h(new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(Number(d.value))),1)],64)):(g(),x("p",sa,"选我就是继续支付"))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["value","aria-label","disabled"]))),128))]),_:1},8,["model-value"])]))}}),oa={class:"flex items-center justify-center px-4"},ia={class:"mt-10"},Ta=R({__name:"IndexPage",setup(n){const o=Oe(D()),a=w(!1),p=r=>{a.value=r},u=w([]),d=()=>{P.getPaymentList().then(r=>{u.value=r}).catch(r=>{N.error(r.error)})};return We(()=>{d()}),(r,c)=>(g(),x(U,null,[m("div",oa,[t(e(gt),{show:a.value,class:"w-sm md:w-md"},{default:s(()=>[t(e(Ce),{class:F(e(j)("min-w-sm sm:min-w-full sm:w-full"))},{default:s(()=>[t(e(Ne),{class:F(e(j)("items-center text-center","dark:bg-gray-900 bg-gray-100 rounded-t-lg"))},{default:s(()=>[t(e(Se),{class:"flex"},{default:s(()=>[c[2]||(c[2]=m("span",null,"余额：",-1)),t(e(A),null,{default:s(()=>[t(e(K),null,{default:s(()=>[t(e(q),{class:F(e(j)("flex flex-row items-center"))},{default:s(()=>[(g(),G(ee(e(Ee)(e(o).getBalance.value))))]),_:1},8,["class"]),t(e(E),{class:F(e(j)("text-lg font-bold"))},{default:s(()=>[k(h(e(o).getBalance.value.toLocaleString()+" 铜币"),1)]),_:1},8,["class"])]),_:1})]),_:1})]),_:1})]),_:1},8,["class"]),t(e(ke),null,{default:s(()=>[t(e(H),{class:F(e(j)("my-5")),label:"兑换余额"},null,8,["class"]),t(e(vt),{class:"space-x-4",loading:a.value,"onUpdate:loading":[c[0]||(c[0]=i=>a.value=i),p]},null,8,["loading"]),t(e(H),{class:F(e(j)("my-5 mt-10")),label:"在线充值"},null,8,["class"]),t(e(Ct),{class:"space-x-4",loading:a.value,"onUpdate:loading":[c[1]||(c[1]=i=>a.value=i),p],"payment-list":u.value},null,8,["loading","payment-list"])]),_:1})]),_:1},8,["class"])]),_:1},8,["show"])]),m("div",ia,[t(e(Ut),{payments:u.value,"parent-loading":a.value},null,8,["payments","parent-loading"])])],64))}});export{Ta as default};
