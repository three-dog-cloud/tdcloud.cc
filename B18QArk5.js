import{b as Ce,_ as ke,a as Ne}from"./CM77qrCQ.js";import{_ as Se}from"./DiCZYgCT.js";import{_ as H,c as L}from"./CgIIxLXQ.js";import{_ as A}from"./CHX-ruqe.js";import{_ as K,a as q,b as E,c as M}from"./CwzeZnIJ.js";import{q as se,m as j,bH as ze,p as le,g as F,t as Te,s as oe,x as O,bI as Pe,Q as Ie,y as Re,r as w,Z as G,k as y,bJ as Fe,T as Ue,bK as Be,a4 as g,ag as x,ab as a,a6 as s,a7 as e,aa as m,ad as N,A as ie,w as re,ae as h,H as B,ah as Q,a5 as W,ar as P,bL as Le,n as je,aq as U,ac as ee,l as ue,aB as De,j as Oe}from"./assets/index-TEvEOdUJ.js";import{W as We,T as I}from"./kVRZTP6F.js";import{u as Y}from"./Dri0889d.js";import{c as de,_ as Ye,a as Ve,b as He,d as Ae,e as Ke,f as qe,g as Ee}from"./B_e_-xHu.js";import{O as k,I as Me}from"./B2fpPDBJ.js";import{t as ce,o as me,s as Ge,k as pe,b as fe,_ as _e,f as ye,c as ge,g as ve,n as Je}from"./NJK3j7en.js";import{_ as Qe}from"./BfxxwK14.js";import{_ as he,a as xe}from"./CjPmofJG.js";import{_ as Xe,a as Ze,b as et,c as tt,d as at,D as nt}from"./h5vYozeV.js";import{d as st,e as lt,_ as ot,b as it,a as rt,c as ut}from"./Cs3I46eI.js";import{_ as dt,a as ct,c as mt,d as pt}from"./Q2geCv2H.js";import{_ as D}from"./Bs14_OVG.js";import{u as ft}from"./OnNQXPer.js";import"./CEBdsFhh.js";import"./DSGlSOUA.js";import"./VOYoOy_q.js";const _t=se([se("@keyframes spin-rotate",`
 from {
 transform: rotate(0);
 }
 to {
 transform: rotate(360deg);
 }
 `),j("spin-container",`
 position: relative;
 `,[j("spin-body",`
 position: absolute;
 top: 50%;
 left: 50%;
 transform: translateX(-50%) translateY(-50%);
 `,[ze()])]),j("spin-body",`
 display: inline-flex;
 align-items: center;
 justify-content: center;
 flex-direction: column;
 `),j("spin",`
 display: inline-flex;
 height: var(--n-size);
 width: var(--n-size);
 font-size: var(--n-size);
 color: var(--n-color);
 `,[le("rotate",`
 animation: spin-rotate 2s linear infinite;
 `)]),j("spin-description",`
 display: inline-block;
 font-size: var(--n-font-size);
 color: var(--n-text-color);
 transition: color .3s var(--n-bezier);
 margin-top: 8px;
 `),j("spin-content",`
 opacity: 1;
 transition: opacity .3s var(--n-bezier);
 pointer-events: all;
 `,[le("spinning",`
 user-select: none;
 -webkit-user-select: none;
 pointer-events: none;
 opacity: var(--n-opacity-spinning);
 `)])]),yt={small:20,medium:18,large:16},gt=Object.assign(Object.assign({},oe.props),{contentClass:String,contentStyle:[Object,String],description:String,stroke:String,size:{type:[String,Number],default:"medium"},show:{type:Boolean,default:!0},strokeWidth:Number,rotate:{type:Boolean,default:!0},spinning:{type:Boolean,validator:()=>!0,default:void 0},delay:Number}),vt=F({name:"Spin",props:gt,setup(n){const{mergedClsPrefixRef:o,inlineThemeDisabled:t}=Te(n),p=oe("Spin","-spin",_t,Be,n,o),u=O(()=>{const{size:i}=n,{common:{cubicBezierEaseInOut:f},self:C}=p.value,{opacitySpinning:v,color:l,textColor:b}=C,_=typeof i=="number"?Pe(i):C[Ie("size",i)];return{"--n-bezier":f,"--n-opacity-spinning":v,"--n-size":_,"--n-color":l,"--n-text-color":b}}),d=t?Re("spin",O(()=>{const{size:i}=n;return typeof i=="number"?String(i):i[0]}),u,n):void 0,r=ft(n,["spinning","show"]),c=w(!1);return G(i=>{let f;if(r.value){const{delay:C}=n;if(C){f=window.setTimeout(()=>{c.value=!0},C),i(()=>{clearTimeout(f)});return}}c.value=r.value}),{mergedClsPrefix:o,active:c,mergedStrokeWidth:O(()=>{const{strokeWidth:i}=n;if(i!==void 0)return i;const{size:f}=n;return yt[typeof f=="number"?"medium":f]}),cssVars:t?void 0:u,themeClass:d==null?void 0:d.themeClass,onRender:d==null?void 0:d.onRender}},render(){var n,o;const{$slots:t,mergedClsPrefix:p,description:u}=this,d=t.icon&&this.rotate,r=(u||t.description)&&y("div",{class:`${p}-spin-description`},u||((n=t.description)===null||n===void 0?void 0:n.call(t))),c=t.icon?y("div",{class:[`${p}-spin-body`,this.themeClass]},y("div",{class:[`${p}-spin`,d&&`${p}-spin--rotate`],style:t.default?"":this.cssVars},t.icon()),r):y("div",{class:[`${p}-spin-body`,this.themeClass]},y(Fe,{clsPrefix:p,style:t.default?"":this.cssVars,stroke:this.stroke,"stroke-width":this.mergedStrokeWidth,class:`${p}-spin`}),r);return(o=this.onRender)===null||o===void 0||o.call(this),t.default?y("div",{class:[`${p}-spin-container`,this.themeClass],style:this.cssVars},y("div",{class:[`${p}-spin-content`,this.active&&`${p}-spin-content--spinning`,this.contentClass],style:this.contentStyle},t),y(Ue,{name:"fade-in-transition"},{default:()=>this.active?c:null})):c}}),ht=F({__name:"RedemptionCodeForm",props:{loading:{type:Boolean,default:!1}},emits:["update:setLoading"],setup(n,{emit:o}){const t=n,p=o,u=ce(me({code:Ge({required_error:"兑换码不能为空",invalid_type_error:"兑换码格式错误"}).min(26,{message:"兑换码格式错误"}).max(26,{message:"兑换码格式错误"})})),d=pe({validationSchema:u}),{handleSubmit:r}=d,c=r(i=>{p("update:setLoading",!0),We.useWalletCode(i.code).then(f=>{p("update:setLoading",!1),Y().setWallet(f),d.resetForm(),k.success("兑换成功")}).catch(f=>{p("update:setLoading",!1),k.error(f.error||"兑换失败")})});return(i,f)=>(g(),x("form",{class:"space-y-6",onSubmit:f[0]||(f[0]=(...C)=>e(c)&&e(c)(...C))},[a(e(ve),{name:"code"},{default:s(({componentField:C})=>[a(e(fe),null,{default:s(()=>[a(e(_e),{class:"text-lg font-bold flex justify-between"},{default:s(()=>[f[2]||(f[2]=m("span",null,"兑换码",-1)),a(e(H),{type:"submit",disabled:t.loading},{default:s(()=>f[1]||(f[1]=[N(" 兑换 ")])),_:1},8,["disabled"])]),_:1}),a(e(ye),null,{default:s(()=>[a(e(Qe),ie({type:"text",placeholder:"请输入兑换码"},C),null,16)]),_:2},1024),a(e(ge))]),_:2},1024)]),_:1})],32))}}),xt={class:"sm:gap-2 sm:items-center sm:flex sm:flex-wrap"},bt={class:"flex items-center justify-between w-full mt-4"},$t=["href"],wt=["src","alt"],Ct={key:0,class:"flex items-center"},kt={key:1},Nt={key:2,class:"flex items-center"},St=F({__name:"RechargeForm",props:{loading:{type:Boolean,default:!1},paymentList:{}},emits:["update:loading"],setup(n,{emit:o}){const t=n,p=o,u=O(()=>t.paymentList),d=w(10),r=w(""),c=v=>{if(f.values.money===void 0)return;if(Array.isArray(v)?r.value=v[0]:r.value=v===void 0?"":v,!r.value){d.value=f.values.money;return}const l=u.value.find(b=>b.uuid===r.value);if(l){let b=d.value;if(l.handling_fee_fixed>0&&(b+=l.handling_fee_fixed),l.handling_fee_percent>0){let _=parseFloat((b*(l.handling_fee_percent/100)).toFixed(2));_>l.handling_fee_percent_max&&(_=l.handling_fee_percent_max),b+=_}d.value=b}},i=ce(me({money:Je({required_error:"",invalid_type_error:"金额格式错误"}).min(10,{message:"最低10，充值金额太少了"}).max(500,{message:"最高500, 超出限制直接联系管理员，手续费太坑了"}).default(10)})),f=pe({validationSchema:i});re(f.values,v=>{v.money!=d.value&&(d.value=v.money,c(r.value===void 0?"":r.value))});const C=f.handleSubmit(v=>{if(r.value===""){k.error("请选择支付方式");return}p("update:loading",!0),I.createTopUpRedirect({money:v.money,payment:r.value}).then(l=>{setTimeout(()=>{window.open(l.redirect,"_blank")},2e3);let b=l.expire_time;k.promise(()=>new Promise((_,S)=>{const V=setInterval(()=>{I.checkPayStatus({session:l.trade_no,payment:r.value}).then(J=>{J.status===1002&&(clearInterval(V),clearTimeout(Z),_(J))}).catch(J=>{clearInterval(V),clearTimeout(Z),S(J)})},4e3),Z=setInterval(()=>{b-=1,b<=0&&(clearInterval(V),clearInterval(Z),S({error:"支付超时，请重新尝试",code:-408}))},1e3)}),{loading:"等待支付中，请勿关闭页面......",success:_=>(Y().initWallet(),p("update:loading",!1),f.resetForm(),c(""),_.status_label),error:_=>(Y().initWallet(),p("update:loading",!1),_.error),position:"top-center"})}).catch(l=>{p("update:loading",!1),k.error(l.error)})});return(v,l)=>(g(),x("form",{class:"space-y-6",onSubmit:l[0]||(l[0]=(...b)=>e(C)&&e(C)(...b))},[a(e(ve),{name:"money"},{default:s(({componentField:b})=>[a(e(fe),null,{default:s(()=>[a(e(_e),{class:"text-lg font-bold flex justify-between"},{default:s(()=>[m("span",null,"实付金额：￥"+h(isNaN(d.value)?0:d.value),1),a(e(H),{type:"submit",disabled:t.loading},{default:s(()=>l[1]||(l[1]=[N(" 充值 ")])),_:1},8,["disabled"])]),_:1}),a(e(ye),null,{default:s(()=>[a(e(Xe),ie({id:"money","default-value":d.value,"format-options":{style:"currency",currency:"CNY",currencyDisplay:"code",currencySign:"accounting"},min:0,max:500},b,{disabled:t.loading}),{default:s(()=>[a(e(Ze),null,{default:s(()=>[a(e(et)),a(e(tt)),a(e(at))]),_:1})]),_:2},1040,["default-value","disabled"])]),_:2},1024),a(e(ge)),m("div",xt,[m("div",bt,[l[2]||(l[2]=m("div",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"支付方式",-1)),m("a",{href:e(nt),target:"_blank",class:"text-sm font-medium text-indigo-600 hover:text-indigo-500"}," 支付说明 ",8,$t)]),a(e(he),{variant:"outline",type:"single",class:"mt-2 grid grid-cols-4 md:grid-cols-5 gap-5 md:gap-6","model-value":r.value,"onUpdate:modelValue":c},{default:s(()=>[(g(!0),x(B,null,Q(u.value,_=>(g(),W(e(xe),{key:_.uuid,value:_.uuid,class:"px-1! py-2!","aria-label":_.name,variant:"outline",disabled:t.loading},{default:s(()=>[a(e(K),null,{default:s(()=>[a(e(q),null,{default:s(()=>[a(e(E),{"as-child":""},{default:s(()=>[m("img",{src:_.icon,alt:_.name,class:"rounded-md object-cover size-6 md:size-8 object-scale-down"},null,8,wt)]),_:2},1024),a(e(M),{class:"text-sm text-gray-900"},{default:s(()=>[m("p",null,h(_.name),1),_.handling_fee_fixed>0?(g(),x("p",Ct,"固定手续费：￥"+h(_.handling_fee_fixed),1)):P("",!0),_.handling_fee_percent>0?(g(),x("p",kt,"手续费："+h(_.handling_fee_percent)+"%",1)):P("",!0),_.handling_fee_percent_max>0?(g(),x("p",Nt," 手续费比例最高扣除：￥"+h(_.handling_fee_percent_max),1)):P("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["value","aria-label","disabled"]))),128))]),_:1},8,["model-value"])])]),_:2},1024)]),_:1})],32))}}),be=w(-1),$e=w(-1),R=w({pageIndex:0,pageSize:10}),$=w(!1),te=(n,o)=>{$.value=!0,I.getTopUpHistory({limit:o,page:n}).then(t=>{je(()=>{Array.isArray(t.items)&&(z.value=t.items),be.value=Math.ceil(t.total/o),$e.value=t.total,$.value=!1})}).catch(t=>{k.error(t.error),$.value=!1})},zt=({pageIndex:n,pageSize:o})=>{R.value.pageIndex=n,R.value.pageSize=o};G(()=>{te(R.value.pageIndex+1,R.value.pageSize)});const X=w(!1),Tt=n=>{X.value=n},Pt=n=>{$.value=!0,I.cancelTopUp(z.value[n].number).then(o=>{const t=[...z.value];t[n].pay_status=3,t[n].pay_status_label="取消支付",z.value=t,$.value=!1,X.value=!1,k.success(o.message||"取消成功")}).catch(o=>{$.value=!1,k.error(o.error)})},we=(n,o,t=3600,p=!1)=>{k.promise(()=>new Promise((u,d)=>{const r=setInterval(()=>{t-=1,t<=0&&(clearInterval(c),clearInterval(r),d({error:"支付超时，请重新尝试",code:-408}))},1e3),c=setInterval(()=>{I.checkPayStatus({session:o,payment:T.value}).then(i=>{i.status===1002&&(clearInterval(c),clearTimeout(r),u(i))}).catch(i=>{clearInterval(c),clearTimeout(r),d(i)})},4e3)}),{loading:"等待支付中，请勿关闭页面......",success:u=>{if(Y().initWallet(),$.value=!1,T.value="",X.value=!1,p)te(R.value.pageIndex+1,R.value.pageSize);else{const d=[...z.value];d[n].pay_status=1,d[n].pay_status_label="支付成功",z.value=d}return u.status_label},error:u=>(Y().initWallet(),$.value=!1,u.error),position:"top-center"})},It=n=>{$.value=!0,I.continuePayRecord(z.value[n].number).then(o=>{setTimeout(()=>{window.open(o.redirect,"_blank")},2e3);const t=new Date().getTime()-new Date(z.value[n].expire_time).getTime();we(n,z.value[n].trade_no,t/1e3)}).catch(o=>{$.value=!1,k.error(o.error)})},Rt=n=>{$.value=!0,I.createTopUpRedirect({payment:T.value,money:ae.value}).then(o=>{setTimeout(()=>{window.open(o.redirect,"_blank")},2e3),we(n,o.trade_no,o.expire_time,!0)}).catch(o=>{$.value=!1,k.error(o.error)})},Ft=n=>{if(!T.value||T.value===""||!ne.value.some(o=>o.uuid===T.value)){k.error("请选择支付方式");return}if(T.value===z.value[n].payment_no){It(n);return}if(ae.value===0){k.error("支付金额错误，请联系管理员查看");return}Rt(n)},ae=w(0),T=w(""),ne=w([]);function Ut(n){ne.value=n}const z=Le([]),Bt=[{id:"pay_name",accessorKey:"payment_name",header:"支付渠道",cell:({row:n})=>y("div",{class:"capitalize"},n.original.payment_name),enableSorting:!1,enableHiding:!1},{id:"pay_money",accessorKey:"pay_money",header:"支付金额",cell:({row:n})=>{const o=new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(Number(n.getValue("pay_money"))/100);return y(ta,{row:n},{default:()=>y("div",{class:"flex space-x-1 justify-center items-center"},[y("span",o),y(Me,{icon:"radix-icons:question-mark-circled",class:"size-4"})])})},enableSorting:!1,enableHiding:!1},{id:"支付状态",accessorKey:"pay_status",header:"支付状态",cell:({row:n})=>y(st,{variant:"outline",class:["dark:text-white text-black",["bg-gray-500","bg-green-500","bg-red-500","bg-yellow-500"][n.original.pay_status]]},{default:()=>n.original.pay_status_label})},{id:"发起时间",accessorKey:"created_at",header:()=>"发起时间",cell:({row:n})=>n.original.created_at},{id:"超时时间",accessorKey:"expire_time",header:"超时时间",cell:({row:n})=>n.original.pay_status===0||n.original.pay_status===2?n.original.expire_time:"-"},{id:"更新时间",accessorKey:"updated_at",header:"更新时间",cell:({row:n})=>n.original.updated_at},{id:"actions",cell:({row:n})=>y("div",{class:"relative"},[y(ea,{open:X.value,row:n,loading:$.value,"onUpdate:setOpen":Tt,"onUpdate:cancelRecord":Pt,"onUpdate:payRecord":Ft},{"pay-slot":()=>y(ra,{payments:ne.value,oldPayment:n.original.payment_no,payment:T.value,price:n.original.actual_amount,loading:$.value,"onUpdate:payment":o=>{T.value=o},"onUpdate:price":o=>ae.value=o})})]),enableHiding:!1}],Lt={sm:["支付状态","发起时间","超时时间","更新时间"],lg:["发起时间","超时时间"]},jt={class:"w-full"},Dt=F({__name:"TopUpRecord",props:{payments:{},parentLoading:{type:Boolean}},setup(n){return re(()=>n.parentLoading,o=>{o||setTimeout(()=>{te(1,R.value.pageSize)},500)}),G(()=>{Ut(n.payments)}),(o,t)=>(g(),x("div",jt,[a(e(de),{loading:e($)},{default:s(()=>[a(e(lt),{data:e(z),columns:e(Bt),"is-selectable":!1,filters:[],hiddenFilters:e(Lt),pagination:e(R),totalPage:e(be),totalCount:e($e),onSetPagination:e(zt)},null,8,["data","columns","hiddenFilters","pagination","totalPage","totalCount","onSetPagination"])]),_:1},8,["loading"])]))}}),Ot={class:"text-xs"},Wt={class:"container"},Yt={class:"grid grid-cols-2 justify-items-center text-center"},Vt={class:"space-y-2"},Ht={class:"text-sm text-muted-foreground"},At={class:"space-y-1"},Kt={class:"text-sm text-muted-foreground"},qt={class:"space-y-2"},Et={class:"text-sm text-muted-foreground"},Mt={class:"space-y-1"},Gt={class:"text-sm text-muted-foreground"},Jt={class:"space-y-1"},Qt={class:"text-sm text-muted-foreground"},Xt={class:"space-y-1"},Zt={class:"text-sm text-muted-foreground"},ea=F({__name:"TopUpRecordDetail",props:{loading:{type:Boolean},open:{type:Boolean},row:{}},emits:["update:setOpen","update:cancelRecord","update:payRecord"],setup(n,{emit:o}){const t=n,p=o,u=O(()=>t.row.original),d=new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(Number(u.value.pay_money/100)),r=new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(Number(u.value.handling_fee/100)),c=new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(Number(u.value.actual_amount/100)),i=[];if(t.row.original.handling_fee>0){const v=new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(t.row.original.handling_fee/100);i.push(y("div","手续费: "+v))}if(t.row.original.handling_fee_fixed>0){const v=new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(t.row.original.handling_fee_fixed);i.push(y("div",`固定手续费：${v}`))}t.row.original.handling_fee_percent>0&&i.push(y("div",`手续费比例：${t.row.original.handling_fee_percent}%`));const f=w(!1),C=v=>{t.loading||(f.value=v)};return G(()=>{t.open===!1&&(f.value=!1)}),(v,l)=>{const b=rt,_=ut;return g(),W(e(pt),{open:f.value,"onUpdate:open":[l[4]||(l[4]=S=>f.value=S),C]},{default:s(()=>[a(e(dt),{"as-child":""},{default:s(()=>[a(e(H),{variant:"ghost",class:"flex h-8 w-8 p-0 data-[state=open]:bg-muted"},{default:s(()=>[a(b,{class:"h-4 w-4"}),l[5]||(l[5]=m("span",{class:"sr-only"},"Open menu",-1))]),_:1})]),_:1}),a(e(ct),{align:"end",class:"w-[160px]"},{default:s(()=>[a(e(ot),null,{default:s(()=>l[6]||(l[6]=[N("操作")])),_:1}),a(e(Ye),{open:t.open,"onUpdate:open":l[3]||(l[3]=S=>{t.loading||p("update:setOpen",S)})},{default:s(()=>[a(e(Ve),null,{default:s(()=>[a(e(mt),{onSelect:l[0]||(l[0]=S=>S.preventDefault())},{default:s(()=>l[7]||(l[7]=[N(" 详情 ")])),_:1})]),_:1}),a(e(He),null,{default:s(()=>[a(e(de),{loading:v.loading},{default:s(()=>[a(e(Ae),null,{default:s(()=>[a(e(Ke),{class:"flex space-x-2"},{default:s(()=>[l[8]||(l[8]=m("span",null," 支付记录 ",-1)),m("div",Ot,"更新时间 "+h(u.value.updated_at),1)]),_:1}),a(e(qe),{class:"items-center text-center"},{default:s(()=>[m("div",{class:U(["inline-block rounded-lg my-2 p-3 bg-gray-100 dark:bg-muted/50 font-bold",[u.value.pay_status==1?"text-green!":"",u.value.pay_status==2?"text-red!":"",u.value.pay_status==3?"text-yellow":""]])},h(u.value.pay_status_label),3),l[9]||(l[9]=m("div",{class:"space-y-1 text-center"},[m("h4",{class:"text-sm font-medium leading-none color-indigo-400"},"Thank you!"),m("p",{class:"text-sm text-muted-foreground"},"如果您有任何疑问，请联系我们。")],-1))]),_:1})]),_:1}),m("div",Wt,[a(e(A),{class:"my-1"}),m("div",Yt,[m("div",Vt,[a(e(D),{class:"text-lg font-medium"},{default:s(()=>l[10]||(l[10]=[N("支付渠道")])),_:1}),m("div",Ht,h(u.value.payment_name),1)]),m("div",At,[a(e(D),{class:"text-lg font-medium"},{default:s(()=>l[11]||(l[11]=[N("支付金额")])),_:1}),m("div",Kt,h(e(d)),1)]),m("div",qt,[a(e(D),{class:"text-lg font-medium"},{default:s(()=>l[12]||(l[12]=[N("创建时间")])),_:1}),m("div",Et,h(u.value.created_at),1)]),m("div",Mt,[a(e(K),null,{default:s(()=>[a(e(q),null,{default:s(()=>[a(e(E),{"as-child":""},{default:s(()=>[a(e(D),{class:"text-lg font-medium flex items-center cursor-pointer"},{default:s(()=>[l[13]||(l[13]=N(" 手续费 ")),a(_,{class:"ml-1 size-4 color-red-600"})]),_:1}),m("div",Gt,h(e(r)),1)]),_:1}),a(e(M),{class:"z-999999999999"},{default:s(()=>[(g(),x(B,null,Q(i,(S,V)=>a(ee(S),{key:V})),64))]),_:1})]),_:1})]),_:1})]),m("div",Jt,[a(e(D),{class:"text-lg font-medium"},{default:s(()=>l[14]||(l[14]=[N("支付截止")])),_:1}),m("div",Qt,h(u.value.pay_status==1?"-":u.value.expire_time),1)]),m("div",Xt,[a(e(D),{class:"text-lg font-medium"},{default:s(()=>l[15]||(l[15]=[N("到账金额")])),_:1}),m("div",Zt,h(e(c)),1)])])]),u.value.pay_status==0||u.value.pay_status==4?(g(),x(B,{key:0},[a(e(A),{class:"my-2"}),ue(v.$slots,"pay-slot"),a(e(A),{class:"my-2"}),a(e(it),null,{default:s(()=>[u.value.pay_status==0?(g(),W(e(H),{key:0,variant:"outline",onClick:l[1]||(l[1]=S=>p("update:cancelRecord",t.row.index))},{default:s(()=>l[16]||(l[16]=[N(" 取消 ")])),_:1})):P("",!0),a(e(H),{onClick:l[2]||(l[2]=S=>p("update:payRecord",t.row.index))},{default:s(()=>[N(h(u.value.pay_status==0?"支付":"继续处理"),1)]),_:1})]),_:1})],64)):P("",!0)]),_:3},8,["loading"])]),_:3})]),_:3},8,["open"])]),_:3})]),_:3},8,["open"])}}}),ta=F({__name:"TopUpRecordPayMoneyTooltip",props:{row:{}},setup(n){const o=n,t=O(()=>o.row),p=new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(t.value.original.actual_amount/100),u=[y("div","到账金额: "+p)];if(t.value.original.handling_fee>0){const d=new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(t.value.original.handling_fee/100);u.push(y("div","手续费: "+d))}if(t.value.original.handling_fee_fixed>0){const d=new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(t.value.original.handling_fee_fixed);u.push(y("div",`固定手续费：${d}`))}return t.value.original.handling_fee_percent>0&&u.push(y("div",`手续费比例：${t.value.original.handling_fee_percent}%`)),(d,r)=>(g(),W(e(K),null,{default:s(()=>[a(e(q),null,{default:s(()=>[a(e(E),null,{default:s(()=>[ue(d.$slots,"default")]),_:3}),a(e(M),null,{default:s(()=>[(g(),x(B,null,Q(u,(c,i)=>a(ee(c),{key:i})),64))]),_:1})]),_:3})]),_:3}))}}),aa={class:"sm:gap-2 sm:items-center sm:flex sm:flex-wrap"},na=["src","alt"],sa={key:0,class:"flex items-center"},la={key:1},oa={key:2,class:"flex items-center"},ia={key:1},ra=F({__name:"PayPayment",props:{price:{default:0},oldPayment:{},payments:{},loading:{type:Boolean,default:!1},payment:{default:""}},emits:["update:payment","update:price"],setup(n,{emit:o}){const t=n,p=o,u=r=>{Array.isArray(r)?p("update:payment",r[0]):p("update:payment",r)},d=w(0);return t.oldPayment!=""&&u(t.oldPayment),G(()=>{if(t.payment){const r=t.payments.find(c=>c.uuid===t.payment);if(r){let c=t.price/100;if(r.handling_fee_fixed>0&&(c+=r.handling_fee_fixed),r.handling_fee_percent>0){let i=parseFloat((c*(r.handling_fee_percent/100)).toFixed(2));i>r.handling_fee_percent_max&&(i=r.handling_fee_percent_max),c+=i}d.value=c,p("update:price",c)}}}),(r,c)=>(g(),x("div",aa,[c[0]||(c[0]=m("div",{class:"flex items-center justify-between w-full mt-4"},[m("div",{class:"text-sm font-medium text-gray-900 dark:text-gray-100"},"支付方式"),m("div",{class:"text-sm font-medium text-indigo-600 hover:text-indigo-500 text-size-xs"}," 默认创建支付渠道，可选其他，注意手续费，悬浮查看手续费详情 ")],-1)),a(e(he),{variant:"outline",type:"single",class:"mt-2 grid grid-cols-4 md:grid-cols-5 gap-5 md:gap-6","model-value":r.payment,"onUpdate:modelValue":u},{default:s(()=>[(g(!0),x(B,null,Q(t.payments,i=>(g(),W(e(xe),{key:i.uuid,value:i.uuid,class:"px-1! py-2!","aria-label":i.name,variant:"outline",disabled:t.loading},{default:s(()=>[a(e(K),null,{default:s(()=>[a(e(q),null,{default:s(()=>[a(e(E),{"as-child":""},{default:s(()=>[m("img",{src:i.icon,alt:i.name,class:"rounded-md object-cover size-6 md:size-8 object-scale-down"},null,8,na)]),_:2},1024),a(e(M),{class:"text-sm text-gray-900"},{default:s(()=>[m("p",null,h(i.name),1),t.oldPayment!==i.uuid?(g(),x(B,{key:0},[i.handling_fee_fixed>0?(g(),x("p",sa,"固定手续费：￥"+h(i.handling_fee_fixed),1)):P("",!0),i.handling_fee_percent>0?(g(),x("p",la,"手续费："+h(i.handling_fee_percent)+"%",1)):P("",!0),i.handling_fee_percent_max>0?(g(),x("p",oa," 手续费比例最高扣除：￥"+h(i.handling_fee_percent_max),1)):P("",!0),m("p",null," 实际支付: "+h(new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(Number(d.value))),1)],64)):(g(),x("p",ia,"选我就是继续支付"))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["value","aria-label","disabled"]))),128))]),_:1},8,["model-value"])]))}}),ua={class:"flex items-center justify-center px-4"},da={class:"mt-10"},Ra=F({__name:"IndexPage",setup(n){const o=De(Y()),t=w(!1),p=r=>{t.value=r},u=w([]),d=()=>{t.value=!0,I.getPaymentList().then(r=>{u.value=r}).catch(r=>{k.error(r.error)}).finally(()=>{t.value=!1})};return Oe(()=>{d()}),(r,c)=>(g(),x(B,null,[m("div",ua,[a(e(vt),{show:t.value,class:"w-sm md:w-md"},{default:s(()=>[a(e(Ce),{class:U(e(L)("min-w-sm sm:min-w-full sm:w-full"))},{default:s(()=>[a(e(ke),{class:U(e(L)("items-center text-center","dark:bg-gray-900 bg-gray-100 rounded-t-lg"))},{default:s(()=>[a(e(Se),{class:"flex"},{default:s(()=>[c[2]||(c[2]=m("span",null,"余额：",-1)),a(e(K),null,{default:s(()=>[a(e(q),null,{default:s(()=>[a(e(E),{class:U(e(L)("flex flex-row items-center"))},{default:s(()=>[(g(),W(ee(e(Ee)(e(o).getBalance.value))))]),_:1},8,["class"]),a(e(M),{class:U(e(L)("text-lg font-bold"))},{default:s(()=>[N(h(e(o).getBalance.value.toLocaleString()+" 铜币"),1)]),_:1},8,["class"])]),_:1})]),_:1})]),_:1})]),_:1},8,["class"]),a(e(Ne),null,{default:s(()=>[a(e(A),{class:U(e(L)("my-5")),label:"兑换余额"},null,8,["class"]),a(e(ht),{class:"space-x-4",loading:t.value,"onUpdate:loading":[c[0]||(c[0]=i=>t.value=i),p]},null,8,["loading"]),a(e(A),{class:U(e(L)("my-5 mt-10")),label:"在线充值"},null,8,["class"]),a(e(St),{class:"space-x-4",loading:t.value,"onUpdate:loading":[c[1]||(c[1]=i=>t.value=i),p],"payment-list":u.value},null,8,["loading","payment-list"])]),_:1})]),_:1},8,["class"])]),_:1},8,["show"])]),m("div",da,[a(e(Dt),{payments:u.value,"parent-loading":t.value},null,8,["payments","parent-loading"])])],64))}});export{Ra as default};
