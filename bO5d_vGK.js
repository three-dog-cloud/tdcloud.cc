import{_ as T}from"./BY31e1Fw.js";import{O as k}from"./BWDXiyOw.js";import{g as y,av as A,r as o,a4 as b,a5 as S,a6 as $,a7 as s,n as w,aj as R,ad as C,ae as O,ar as P}from"./assets/index-BE9XhI5F.js";import{_ as B}from"./DAvAWswm.js";import"./3K1s4utO.js";import"./CRQdokPm.js";import"./CRum8ecR.js";import"./BmMxN-ha.js";import"./BEbPrrrj.js";import"./YaxshJu-.js";const G=y({__name:"IndexPage",setup(D){const r=A(),c=r.currentRoute.value.params.func,l=r.currentRoute.value.params.platform,f=r.currentRoute.value.query,i=t=>{const e=`${c==="bind"?"绑定":"授权"} ${l.toString()} `;switch(t){case"loading":return`${e}中...`;case"success":return`${e}成功`;case"error":return`${e}失败`;default:return"错误，请联系管理员"}},v=t=>{switch(t){case"loading":return"正在探索服务器的世界...";case"success":return"成功与终端建立连接";case"error":return"终端拒绝了你的想法";default:return"错误，请联系管理员"}},g=o(!1),m=o(i("loading")),p=o(v("loading")),u=o(""),a=o(5),d=()=>{a.value=a.value-1},x=t=>{k.bindAccountOAuth(l.toString(),f).then(e=>{t.value="success",u.value=e.message||"绑定成功",setInterval(()=>{d(),a.value===0&&_()},1e3)}).catch(e=>{t.value="error",u.value=e.error}).finally(()=>{m.value=i(t.value),p.value=v(t.value)})},I=t=>{k.callbackAccountOAuth(l.toString(),f).then(e=>{t.value="success";const n=setInterval(()=>{d(),a.value===0&&(clearInterval(n),w(()=>{const h=R();h.setToken(e.token,e.token_timeout),h.setRefreshToken(e.refresh_token,e.refresh_token_timeout),r.push({name:"HomePage"})}))},1e3)}).catch(e=>{if(t.value="error",e.code===20114&&(e.error+="，你是不是没有注册账户呢？"),u.value=e.error,e.code===30101){g.value=!0;const n=setInterval(()=>{d(),a.value===0&&(clearInterval(n),w(()=>{r.push({name:"LoginPage"})}))},1e3)}}).finally(()=>{m.value=i(t.value),p.value=v(t.value)})},_=()=>{window.close()};return(t,e)=>(b(),S(s(T),{title:m.value,description:p.value,"response-message":u.value,init:s(c)==="bind"?x:I},{"operating-area":$(({status:n})=>[n!=="error"||g.value?(b(),S(s(B),{key:0,onClick:_,variant:"outline",disabled:s(c)!=="bind"},{default:$(()=>[C(O(a.value+"秒后"+(s(c)==="bind"?"自动关闭":"回到主页")),1)]),_:1},8,["disabled"])):P("",!0)]),_:1},8,["title","description","response-message","init"]))}});export{G as default};
